// ==UserScript==
// @name Export Element
// @description Add a context menu option to print a HTML element including all styles
// @version 1.4.3
// @author iamogbz
// @homepage https://github.com/iamogbz/oh-my-scripts
// @supportURL https://github.com/iamogbz/oh-my-scripts/issues
// @match *://*/*
// @downloadURL https://github.com/iamogbz/oh-my-scripts/raw/1.4.3/export-element.user.js
// @grant GM_registerMenuCommand
// @icon https://github.com/iamogbz/oh-my-scripts/raw/main/assets/monkey_128.png
// @namespace iamogbz/oh-my-scripts
// @updateURL https://github.com/iamogbz/oh-my-scripts/raw/gh-pages/export-element.user.js
// ==/UserScript==

(()=>{"use strict";!function(){const e=Object.freeze({PDF:"pdf"}),t={eventTarget:null,target:null,type:e.PDF};function n(e,t){for(;e;){if(t(e))return e;e=e.parentNode}return null}function o(e){var t;return null!==(t=null==e?void 0:e.replace(/\s+/g," ").trim())&&void 0!==t?t:""}document.addEventListener("contextmenu",(function(e){var r,i,l,d,u,c,a,s,v,f,g;t.eventTarget=e.target;const p=o(null!==(g=null!==(c=null!==(l=null===(i=null===(r=window.getSelection)||void 0===r?void 0:r.call(window))||void 0===i?void 0:i.toString())&&void 0!==l?l:null===(u=null===(d=document.getSelection)||void 0===d?void 0:d.call(document))||void 0===u?void 0:u.toString())&&void 0!==c?c:null===(f=null===(v=null===(s=null===(a=Object.getOwnPropertyDescriptor(document,"selection"))||void 0===a?void 0:a.value)||void 0===s?void 0:s.createRange)||void 0===v?void 0:v.call(s))||void 0===f?void 0:f.text)&&void 0!==g?g:"").split(" ");t.target=n(e.target,(e=>{const t=o(e.innerText);return n=t,p.every((e=>n.includes(e)));var n}))})),Object.values(e).forEach((o=>{window.GM_registerMenuCommand(`As ${o.toUpperCase()}`,(()=>{!function(o){if(t.target){if(o===e.PDF)return function(e){const t=window.open("","","width=800,height=600");if(!t)return void alert("Please allow popups for this site and try again.");const o=t.document,r=function(e,t){function n(t,n){const o=e.getComputedStyle(t);for(const e of o)n.style.setProperty(e,o.getPropertyValue(e))}const o=t.cloneNode(!0);return n(t,o),function e(t,o){const r=t;for(let t=0;t<r.children.length;t++){const i=o;n(r.children[t],i.children[t]),e(r.children[t],i.children[t])}}(t,o),o}(window,e);"body"===r.tagName.toLowerCase()?o.body.outerHTML=r.outerHTML:o.body.appendChild(r),o.body.style.backgroundColor=function(e){const t="transparent",o=n(e,(e=>{if(!(e instanceof Element))return!1;const n=window.getComputedStyle(e).backgroundColor;if(!n)return!1;if(n===t)return!1;const o=n.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);return!o||0!==(o[4]?parseFloat(o[4]):1)}));return o?window.getComputedStyle(o).getPropertyValue("background-color"):t}(e),t.setTimeout((()=>t.print()),1e3),t.addEventListener("afterprint",(function(){this.confirm("Close window after successful print?")&&t.close()}))}(t.target);alert(`Unsupported type: ${o}`)}else console.error("Node not found!",t.eventTarget)}(o)}),`as-${o.toLowerCase()}`)}))}()})();