"use strict";(self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[]).push([[645],{2639:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(l,r){function n(e){try{a(s.next(e))}catch(e){r(e)}}function o(e){try{a(s.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}a((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendFilePreview=void 0,t.filePreviewNS=function(e){return`iamogbz-gh-file-preview-${e}`};const l=i(9091),r=i(6116),n=i(7131),o=i(8730);t.ExtendFilePreview=class{constructor(e,t,i){this.frameTagName="iframe",this.toggleActionSource="source",this.toggleActionRender="render",this.frameStyle={background:"white",border:"none",display:"block",height:"100%",left:0,padding:0,position:"absolute",top:0,width:"100%"},this.id=e,this.featureClass=t,this.fileTypes=i}initCondition(){return(0,r.isCommit)()||(0,r.isCompare)()||(0,r.isPRFiles)()||(0,r.isSingleFile)()}setup(){const e=()=>{this.initCondition()&&this.initFeature()};let t=null;(0,l.observeEl)(document.body,(()=>{t&&t===window.location.href||(t=window.location.href,e())}),{childList:!0,subtree:!0})}pathToFile(e){return`${(0,r.getUserRepo)()}/${e}`}pathToBlob(e){return`https://raw.githubusercontent.com/${this.pathToFile(e)}`}getFileContent(e){return this.safeFetch((0,n.isAbsolutePath)(e)?e:this.pathToBlob(e)).then((e=>{var t;return null===(t=e.text)||void 0===t?void 0:t.call(e)})).catch((t=>{if(console.info(t),(0,n.isAbsolutePath)(e))return;const[i,...s]=e.split("/");return r.githubApi.v3(`${this.pathToApi(s.join("/"))}?ref=${i}`).then((e=>atob(e.content))).catch((e=>{console.error(e)}))}))}safeFetch(e,t){return(0,o.request)(e,t).then((e=>{if(200!==e.status)throw new Error(`${e.status} - ${e.statusText}`);return e}))}isSupportedFile(e){return this.fileTypes.has((0,n.getFileType)(e))}pathToApi(e){return`repos/${(0,r.getUserRepo)()}/contents/${e}`}selectButton(e){const t=(0,l.selectDOM)(`.BtnGroup.${this.featureClass} .BtnGroup-item.selected`);t&&t.classList.remove("selected"),e.classList.add("selected"),e.blur()}showSource(e){return t=>{const i=t.currentTarget;if(i.disabled||!e)return;e.style.visibility="hidden";const s=e.parentElement;return null==s||s.style.removeProperty("overflow"),null==s||s.style.removeProperty("height"),null==s||s.style.removeProperty("max-height"),this.selectButton(i)}}showRendered(e){return t=>{const i=t.currentTarget,s=this.getContainerElement(e),l=this.getScrollHeight(e);if(!s||!l||i.disabled)return;e.style.visibility="visible",s.style.overflow="hidden";const r=`${l}px`;return s.style.height=r,s.style.maxHeight=r,s.scrollLeft=0,this.selectButton(i)}}getContainerElement(e){return e.parentElement}getScrollHeight(e){return e.contentWindow?e.contentWindow.document.body.scrollHeight+32:0}updateToggle(e,t){var i;e.disabled=!t,e.dataset.toggleAction===this.toggleActionRender&&(e.onclick=this.showRendered(t)),e.dataset.toggleAction===this.toggleActionSource&&(e.onclick=this.showSource(t)),e.setAttribute("aria-label",null!==(i=e.disabled?e.dataset.labelDisabled:e.dataset.labelEnabled)&&void 0!==i?i:"")}viewerButtonToggleGroup({frameElem:e,isFileList:t}){var i;const s=!e,r="Render toggle disabled",n=(0,l.getTagNS)("svg"),o=(0,l.createElement)({attributes:{"aria-current":"true",class:`btn btn-sm BtnGroup-item tooltipped tooltipped-${t?"w":"n"} source ${t?"js-source":""} ${t?"":"selected"}`,"data-disable-with":"","data-label-disabled":r,"data-label-enabled":"Display the source "+(t?"diff":"blob"),"data-toggle-action":this.toggleActionSource,disabled:s},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-code",height:16,version:"1.1",viewBox:"0 0 16 16",width:16},children:[{attributes:{d:"M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z","fill-rule":"evenodd"},tagName:"path",tagNS:n}],tagName:"svg",tagNS:n}],events:{click:this.showSource(e)},tagName:"button"}),a=(0,l.createElement)({attributes:{class:`btn btn-sm BtnGroup-item tooltipped tooltipped-${t?"w":"n"} rendered ${t?"js-rendered":""}`,disabled:s,"data-disable-with":"","data-label-disabled":r,"data-label-enabled":"Display the "+(t?"rich diff":"rendered blob"),"data-toggle-action":this.toggleActionRender},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-file",height:16,version:"1.1",viewBox:"0 0 16 16",width:16},children:[{attributes:{d:"M3.75 1.5a.25.25 0 00-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V6H9.75A1.75 1.75 0 018 4.25V1.5H3.75zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06zM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25V1.75z","fill-rule":"evenodd"},tagName:"path",tagNS:n}],tagName:"svg",tagNS:n}],events:{click:this.showRendered(e)},tagName:"button"});this.updateToggle(o,e),this.updateToggle(a,e);const d=`${e.id}-button-group`,c=`BtnGroup ${this.featureClass}`;return(0,l.createElement)({attributes:{id:d,class:c},children:[o,a],tagName:"span",reuse:null!==(i=document.getElementById(d))&&void 0!==i?i:void 0})}fileViewerButtonToggle({actionsElem:e,frameElem:t}){var i,s;const l=`${t.id}-button-group`,r=document.getElementById(l),n=null!=r?r:document.createElement("li"),o="aria-current",a=`button[${o}]`,d=e=>"true"===e.getAttribute(o),c=Array.from(e.querySelectorAll(a)),u=c.filter(d)[0],h=null==u?void 0:u.getAttribute("class"),m=null===(i=null==u?void 0:u.parentElement)||void 0===i?void 0:i.getAttribute("class"),g=c.filter((e=>!d(e)))[0],b=null==g?void 0:g.getAttribute("class"),p=null===(s=null==g?void 0:g.parentElement)||void 0===s?void 0:s.getAttribute("class");if(!r){n.innerHTML=`\x3c!-- github-file-${this.id}-created-button --\x3e<button aria-current="false" data-hotkey="Meta+/ Meta+p" class="${b}">\n      <span class="segmentedControl-content">\n      <div class="Box-sc-g0xbh4-0 segmentedControl-text">Preview</div>\n      </span>\n      </button>`,n.id=l,n.className=null!=p?p:"";const e=n.querySelector(a),i=e=>{var t;e.setAttribute(o,"true"),h&&e.setAttribute("class",h),m&&(null===(t=e.parentElement)||void 0===t||t.setAttribute("class",m))},s=e=>{var t;e.setAttribute(o,"false"),b&&e.setAttribute("class",b),m&&(null===(t=e.parentElement)||void 0===t||t.setAttribute("class",m))};n.addEventListener("click",(l=>{this.showRendered(t)(l),c.forEach(s),e&&i(e)})),c.forEach((l=>{l.addEventListener("click",(r=>{this.showSource(t)(r),i(l),e&&s(e)}))}))}return n}getFrameElem(e){const t=`${this.frameTagName}.${this.featureClass}`;return(0,l.selectDOM)(t,null!=e?e:document.body)}frameElement(e,t){var i;const s=this.getFrameElem(t);return(0,l.createElement)({attributes:Object.assign({class:this.featureClass,style:(0,l.createElementStyle)(Object.assign({visibility:null!==(i=null==s?void 0:s.style.visibility)&&void 0!==i?i:"hidden"},this.frameStyle))},e),tagName:this.frameTagName,reuse:this.getFrameElem(t)})}addButtonsToFileHeaderActions(e,t){var i;const s=`.BtnGroup.${this.featureClass}`;if((0,l.selectExists)(s,e))return void(null===(i=(0,l.selectDOM)(s,e))||void 0===i||i.childNodes.forEach((e=>{this.updateToggle(e,t)})));const n=(0,r.isPRFiles)()||(0,r.isCommit)()||(0,r.isCompare)();n&&(e.style.alignItems="center"),e.insertBefore(n?this.viewerButtonToggleGroup({frameElem:t,isFileList:n}):this.fileViewerButtonToggle({actionsElem:e,frameElem:t}),e.firstChild)}addFrameToFileBody(e,t,i){return s(this,void 0,void 0,(function*(){if(i&&!(0,l.selectExists)(".js-blob-wrapper",e))return;const s={"data-filepath":t,src:`https://rawgit.com/${this.pathToFile(t)}`,srcDoc:yield this.prepareHTML(yield this.getFileContent(t),t)},r=this.frameElement(s,e);return e.style.position="relative",(0,l.observeEl)(e,(()=>{e.lastElementChild!==r&&e.appendChild(r)}),{childList:!0,subtree:!0}),r}))}extendHtmlFileDetailsElements(e){return()=>Promise.all((0,l.selectAll)(".file.Details").map((t=>s(this,void 0,void 0,(function*(){const i=(0,l.selectOrThrow)(".file-header",t);if(!i.dataset.path)return;const s=`${e}/${i.dataset.path}`;if(this.isSupportedFile(s))try{const e=yield this.addFrameToFileBody((0,l.selectOrThrow)(".js-file-content",t),s,!0);if(!e)return;this.addButtonsToFileHeaderActions((0,l.selectOrThrow)(".file-actions>.d-flex",i),e)}catch(e){console.error(e)}})))))}initDiff(e){if(!e)return;const t=this.extendHtmlFileDetailsElements(e);(0,l.observeEl)("#files",t,{childList:!0,subtree:!0})}initCommit(){this.initDiff((0,r.getCommitSha)())}initCompare(){this.initDiff((0,r.getCompareHeadSha)())}initPRFiles(){var e;this.initDiff(null===(e=(0,l.selectDOM)(".js-reviews-container #head_sha"))||void 0===e?void 0:e.value)}initSingleFile(){return s(this,void 0,void 0,(function*(){const e=(0,r.getRepoPath)().replace("blob/","");if(!this.isSupportedFile(e)){const e=this.getFrameElem();return void(e&&(e.style.visibility="hidden"))}const t=yield this.addFrameToFileBody(yield(0,l.selectOrReject)("section[aria-labelledby='file-name-id']"),e,!1);t&&this.addButtonsToFileHeaderActions(yield(0,l.selectOrReject)("ul[aria-label='File view']"),t)}))}initFeature(){const e=(0,r.isPRFiles)()&&this.initPRFiles(),t=(0,r.isSingleFile)()&&this.initSingleFile(),i=(0,r.isCommit)()&&this.initCommit(),s=(0,r.isCompare)()&&this.initCompare();return Promise.all([e,t,i,s]).then((e=>e.some(Boolean)))}}}}]);