"use strict";(self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[]).push([[610],{1543:function(t,e,i){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)},r=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendFilePreview=e.filePreviewNS=void 0;var s=i(1486),l=i(5008),c=i(8008),u=i(1603);e.filePreviewNS=function(t){return"iamogbz-gh-file-preview-".concat(t)};var h=function(){function t(){this.frameTagName="iframe",this.toggleActionSource="source",this.toggleActionRender="render",this.frameStyle={background:"white",border:"none",display:"block",height:"100%",left:0,padding:0,position:"absolute",top:0,width:"100%",visibility:"hidden"}}return t.prototype.initCondition=function(){return(0,l.isCommit)()||(0,l.isCompare)()||(0,l.isPRFiles)()||(0,l.isSingleFile)()},t.prototype.setup=function(){var t=this;(0,l.onAjaxedPagesRaw)((function(){t.initCondition()&&t.initFeature()}))},t.prototype.pathToFile=function(t){return"".concat((0,l.getUserRepo)(),"/").concat(t)},t.prototype.pathToBlob=function(t){return"https://raw.githubusercontent.com/".concat(this.pathToFile(t))},t.prototype.getFileContent=function(t){var e=this;return this.safeFetch((0,c.isAbsolutePath)(t)?t:this.pathToBlob(t)).then((function(t){var e;return null===(e=t.text)||void 0===e?void 0:e.call(t)})).catch((function(i){if(console.info(i),!(0,c.isAbsolutePath)(t)){var n=a(t.split("/")),r=n[0],o=n.slice(1);return l.githubApi.v3("".concat(e.pathToApi(o.join("/")),"?ref=").concat(r)).then((function(t){return atob(t.content)})).catch((function(t){console.error(t)}))}}))},t.prototype.safeFetch=function(t,e){return(0,u.request)(t,e).then((function(t){if(200!==t.status)throw new Error("".concat(t.status," - ").concat(t.statusText));return t}))},t.prototype.isSupportedFile=function(t){return this.fileTypes.has((0,c.getFileType)(t))},t.prototype.pathToApi=function(t){return"repos/".concat((0,l.getUserRepo)(),"/contents/").concat(t)},t.prototype.selectButton=function(t){var e=(0,s.selectDOM)(".BtnGroup.".concat(this.featureClass," .BtnGroup-item.selected"));e&&e.classList.remove("selected"),t.classList.add("selected"),t.blur()},t.prototype.showSource=function(t){var e=this;return function(i){var n=i.currentTarget;if(!n.disabled&&t){t.style.visibility="hidden";var r=t.parentElement;return null==r||r.style.removeProperty("overflow"),null==r||r.style.removeProperty("height"),null==r||r.style.removeProperty("max-height"),e.selectButton(n)}}},t.prototype.showRendered=function(t){var e=this;return function(i){var n=i.currentTarget,r=e.getContainerElement(t),o=e.getScrollHeight(t);if(r&&o&&!n.disabled){t.style.visibility="visible",r.style.overflow="hidden";var a="".concat(o,"px");return r.style.height=a,r.style.maxHeight=a,r.scrollLeft=0,e.selectButton(n)}}},t.prototype.getContainerElement=function(t){return t.parentElement},t.prototype.getScrollHeight=function(t){return t.contentWindow?t.contentWindow.document.body.scrollHeight+32:0},t.prototype.updateToggle=function(t,e){var i;t.disabled=!e,t.dataset.toggleAction===this.toggleActionRender&&(t.onclick=this.showRendered(e)),t.dataset.toggleAction===this.toggleActionSource&&(t.onclick=this.showSource(e)),t.setAttribute("aria-label",null!==(i=t.disabled?t.dataset.labelDisabled:t.dataset.labelEnabled)&&void 0!==i?i:"")},t.prototype.viewerButtonToggleGroup=function(t){var e=t.frameElem,i=t.isFileList,n=!e,r="Render toggle disabled",o=(0,s.getTagNS)("svg"),a=(0,s.createElement)({attributes:{"aria-current":"true",class:"btn btn-sm BtnGroup-item tooltipped tooltipped-".concat(i?"w":"n"," source ").concat(i?"js-source":""," ").concat(i?"":"selected"),"data-disable-with":"","data-label-disabled":r,"data-label-enabled":"Display the source ".concat(i?"diff":"blob"),"data-toggle-action":this.toggleActionSource,disabled:n},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-code",height:16,version:"1.1",viewBox:"0 0 16 16",width:16},children:[{attributes:{d:"M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z","fill-rule":"evenodd"},tagName:"path",tagNS:o}],tagName:"svg",tagNS:o}],events:{click:this.showSource(e)},tagName:"button"}),l=(0,s.createElement)({attributes:{class:"btn btn-sm BtnGroup-item tooltipped tooltipped-".concat(i?"w":"n"," rendered ").concat(i?"js-rendered":""),disabled:n,"data-disable-with":"","data-label-disabled":r,"data-label-enabled":"Display the ".concat(i?"rich diff":"rendered blob"),"data-toggle-action":this.toggleActionRender},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-file",height:16,version:"1.1",viewBox:"0 0 16 16",width:16},children:[{attributes:{d:"M3.75 1.5a.25.25 0 00-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V6H9.75A1.75 1.75 0 018 4.25V1.5H3.75zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06zM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25V1.75z","fill-rule":"evenodd"},tagName:"path",tagNS:o}],tagName:"svg",tagNS:o}],events:{click:this.showRendered(e)},tagName:"button"});return this.updateToggle(a,e),this.updateToggle(l,e),(0,s.createElement)({attributes:{class:"BtnGroup ".concat(this.featureClass)},children:[a,l],tagName:"span"})},t.prototype.fileViewerButtonToggle=function(t){var e,i=this,n=t.actionsElem,r=t.frameElem,o="aria-current",a="button[".concat(o,"]"),s=Array.from(n.querySelectorAll(a)),l=s.filter((function(t){return"true"===t.getAttribute(o)}))[0],c=l.getAttribute("class"),u=l.parentElement.getAttribute("class"),h=s.filter((function(t){return"false"===t.getAttribute(o)}))[0],d=h.getAttribute("class"),p=null===(e=h.parentElement)||void 0===e?void 0:e.getAttribute("class"),f=document.createElement("div");f.innerHTML="\x3c!-- github-file-".concat(this.id,'-created-button --\x3e\n    <li class="').concat(p,'">\n    <button aria-current="false" data-hotkey="Meta+/ Meta+p" class="').concat(d,'">\n    <span class="segmentedControl-content">\n    <div class="Box-sc-g0xbh4-0 segmentedControl-text">Preview</div>\n    </span>\n    </button>\n    </li>');var g=f.firstElementChild,b=g.querySelector(a),m=function(t){var e;t.setAttribute(o,"true"),c&&t.setAttribute("class",c),u&&(null===(e=t.parentElement)||void 0===e||e.setAttribute("class",u))},v=function(t){var e;t.setAttribute(o,"false"),d&&t.setAttribute("class",d),u&&(null===(e=t.parentElement)||void 0===e||e.setAttribute("class",u))};return g.addEventListener("click",(function(t){i.showRendered(r)(t),m(b),s.forEach(v)})),s.forEach((function(t){t.addEventListener("click",(function(e){i.showSource(r)(e),m(t),v(b)}))})),this.updateToggle(b,r),g},t.prototype.frameElement=function(t){return(0,s.createElement)({attributes:n({class:this.featureClass,style:(0,s.createElementStyle)(this.frameStyle)},t),tagName:this.frameTagName})},t.prototype.addButtonsToFileHeaderActions=function(t,e){var i,n=this,r=".BtnGroup.".concat(this.featureClass);if((0,s.selectExists)(r,t))null===(i=(0,s.selectDOM)(r,t))||void 0===i||i.childNodes.forEach((function(t){n.updateToggle(t,e)}));else{var o=(0,l.isPRFiles)()||(0,l.isCommit)()||(0,l.isCompare)();o&&(t.style.alignItems="center"),t.insertBefore(o?this.viewerButtonToggleGroup({frameElem:e,isFileList:o}):this.fileViewerButtonToggle({actionsElem:t,frameElem:e}),t.firstChild)}},t.prototype.addFrameToFileBody=function(t,e,i){return r(this,void 0,void 0,(function(){var n,r,a,l,c;return o(this,(function(o){switch(o.label){case 0:return i&&!(0,s.selectExists)(".js-blob-wrapper",t)?[2,void 0]:(n="".concat(this.frameTagName,".").concat(this.featureClass),(0,s.selectExists)(n,t)?[2,(0,s.selectDOM)(n,t)]:(a=this.frameElement,c={src:"https://rawgit.com/".concat(this.pathToFile(e))},l=this.prepareHTML,[4,this.getFileContent(e)]));case 1:return[4,l.apply(this,[o.sent(),e])];case 2:return r=a.apply(this,[(c.srcDoc=o.sent(),c)]),t.style.position="relative",[2,t.appendChild(r)]}}))}))},t.prototype.extendHtmlFileDetailsElements=function(t){var e=this;return function(){return Promise.all((0,s.selectAll)(".file.Details").map((function(i){return r(e,void 0,void 0,(function(){var e,n,r,a;return o(this,(function(o){switch(o.label){case 0:if(!(e=(0,s.selectOrThrow)(".file-header",i)).dataset.path)return[2];if(n="".concat(t,"/").concat(e.dataset.path),!this.isSupportedFile(n))return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.addFrameToFileBody((0,s.selectOrThrow)(".js-file-content",i),n,!0)];case 2:return(r=o.sent())?(this.addButtonsToFileHeaderActions((0,s.selectOrThrow)(".file-actions>.d-flex",e),r),[3,4]):[2];case 3:return a=o.sent(),console.error(a),[3,4];case 4:return[2]}}))}))})))}},t.prototype.initDiff=function(t){if(t){var e=this.extendHtmlFileDetailsElements(t);(0,s.observeEl)("#files",e,{childList:!0,subtree:!0})}},t.prototype.initCommit=function(){this.initDiff((0,l.getCommitSha)())},t.prototype.initCompare=function(){this.initDiff((0,l.getCompareHeadSha)())},t.prototype.initPRFiles=function(){var t;this.initDiff(null===(t=(0,s.selectDOM)(".js-reviews-container #head_sha"))||void 0===t?void 0:t.value)},t.prototype.initSingleFile=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(i){switch(i.label){case 0:return t=(0,l.getRepoPath)().replace("blob/",""),this.isSupportedFile(t)?[4,this.addFrameToFileBody((0,s.selectOrThrow)("section[aria-labelledby='file-name-id']"),t,!1)]:[2];case 1:return(e=i.sent())?(this.addButtonsToFileHeaderActions((0,s.selectOrThrow)("ul[aria-label='File view']"),e),[2]):[2]}}))}))},t.prototype.initFeature=function(){var t=(0,l.isPRFiles)()&&this.initPRFiles(),e=(0,l.isSingleFile)()&&this.initSingleFile(),i=(0,l.isCommit)()&&this.initCommit(),n=(0,l.isCompare)()&&this.initCompare();return Promise.all([t,e,i,n]).then((function(t){return t.some(Boolean)}))},t}();e.ExtendFilePreview=h}}]);