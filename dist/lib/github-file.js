(self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[]).push([[610],{1543:function(e,t,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendFilePreview=t.filePreviewNS=void 0;var a=i(1486),l=i(5008),c=i(8008),u=i(1603);t.filePreviewNS=function(e){return"iamogbz-gh-file-preview-"+e};var h=function(){function e(){this.toggleActionSource="source",this.toggleActionRender="render",this.frameStyle={background:"white",border:"none",display:"none",height:"100%",left:0,padding:0,position:"absolute",top:0,width:"100%"}}return e.prototype.setup=function(){var e=this;l.onAjaxedPagesRaw((function(){(l.isCommit()||l.isPRFiles()||l.isSingleFile())&&e.initFeature()}))},e.prototype.pathToFile=function(e){return l.getUserRepo()+"/"+e},e.prototype.pathToBlob=function(e){return"https://raw.githubusercontent.com/"+this.pathToFile(e)},e.prototype.getFileContent=function(e){var t=this;return this.safeFetch(c.isAbsolutePath(e)?e:this.pathToBlob(e)).then((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.call(e)})).catch((function(i){if(console.info(i),!c.isAbsolutePath(e)){var r=s(e.split("/")),n=r[0],o=r.slice(1);return l.githubApi.v3(t.pathToApi(o.join("/"))+"?ref="+n).then((function(e){return atob(e.content)})).catch((function(e){console.error(e)}))}}))},e.prototype.safeFetch=function(e,t){return u.request(e,t).then((function(e){if(200!==e.status)throw new Error(e.status+" - "+e.statusText);return e}))},e.prototype.isSupportedFile=function(e){return this.fileTypes.has(c.getFileType(e))},e.prototype.pathToApi=function(e){return"repos/"+l.getUserRepo()+"/contents/"+e},e.prototype.selectButton=function(e){var t=a.selectDOM(".BtnGroup."+this.featureClass+" .BtnGroup-item.selected");t&&t.classList.remove("selected"),e.classList.add("selected"),e.blur()},e.prototype.showSource=function(e){var t=this;return function(i){var r=i.currentTarget;if(!r.disabled&&e){e.style.display="none";var n=e.parentElement;return null==n||n.style.removeProperty("overflow"),null==n||n.style.removeProperty("height"),null==n||n.style.removeProperty("max-height"),t.selectButton(r)}}},e.prototype.showRendered=function(e){var t=this;return function(i){var r=i.currentTarget;if(e.contentWindow&&e.parentElement&&!r.disabled){e.style.display="block";var n=e.parentElement;n.style.overflow="hidden";var o=e.contentWindow.document.body.scrollHeight+32+"px";return n.style.height=o,n.style.maxHeight=o,t.selectButton(r)}}},e.prototype.updateToggle=function(e,t){var i;e.disabled=!t,e.dataset.toggleAction===this.toggleActionRender&&(e.onclick=this.showRendered(t)),e.dataset.toggleAction===this.toggleActionSource&&(e.onclick=this.showSource(t)),e.setAttribute("aria-label",null!==(i=e.disabled?e.dataset.labelDisabled:e.dataset.labelEnabled)&&void 0!==i?i:"")},e.prototype.viewerButtonToggleGroup=function(e){var t=e.frameElem,i=e.isFileList,r=!t,n="HTML render toggle disabled",o=a.getTagNS("svg"),s=a.createElement({attributes:{"aria-current":"true",class:"btn btn-sm BtnGroup-item tooltipped tooltipped-"+(i?"w":"n")+" source "+(i?"js-source":"")+" "+(i?"":"selected"),"data-disable-with":"","data-label-disabled":n,"data-label-enabled":"Display the source "+(i?"diff":"blob"),"data-toggle-action":this.toggleActionSource,disabled:r},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-code",height:16,version:"1.1",viewBox:"0 0 14 16",width:14},children:[{attributes:{d:"M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z","fill-rule":"evenodd"},tagName:"path",tagNS:o}],tagName:"svg",tagNS:o}],events:{click:this.showSource(t)},tagName:"button"}),l=a.createElement({attributes:{class:"btn btn-sm BtnGroup-item tooltipped tooltipped-"+(i?"w":"n")+" rendered "+(i?"js-rendered":""),disabled:r,"data-disable-with":"","data-label-disabled":n,"data-label-enabled":"Display the "+(i?"rich diff":"rendered blob"),"data-toggle-action":this.toggleActionRender},children:[{attributes:{"aria-hidden":"true",class:"octicon octicon-file",height:16,version:"1.1",viewBox:"0 0 12 16",width:12},children:[{attributes:{d:"M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45\n                1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z","fill-rule":"evenodd"},tagName:"path",tagNS:o}],tagName:"svg",tagNS:o}],events:{click:this.showRendered(t)},tagName:"button"});return this.updateToggle(s,t),this.updateToggle(l,t),a.createElement({attributes:{class:"BtnGroup "+this.featureClass},children:[s,l],tagName:"span"})},e.prototype.frameElement=function(e){return a.createElement({attributes:r({class:this.featureClass,style:a.createElementStyle(this.frameStyle)},e),tagName:"iframe"})},e.prototype.addButtonsToFileHeaderActions=function(e,t){var i,r=this,n=".BtnGroup."+this.featureClass;a.selectExists(n,e)?null===(i=a.selectDOM(n,e))||void 0===i||i.childNodes.forEach((function(e){r.updateToggle(e,t)})):e.insertBefore(this.viewerButtonToggleGroup({frameElem:t,isFileList:l.isPRFiles()||l.isCommit()}),e.firstChild)},e.prototype.addFrameToFileBody=function(e,t,i){return n(this,void 0,void 0,(function(){var r,n,s,l;return o(this,(function(o){switch(o.label){case 0:return i&&!a.selectExists(".js-blob-wrapper",e)?[2,void 0]:a.selectExists("iframe."+this.featureClass,e)?[2,a.selectDOM("iframe."+this.featureClass,e)]:(n=this.frameElement,l={src:"https://rawgit.com/"+this.pathToFile(t)},s=this.prepareHTML,[4,this.getFileContent(t)]);case 1:return[4,s.apply(this,[o.sent(),t])];case 2:return r=n.apply(this,[(l.srcDoc=o.sent(),l)]),e.style.position="relative",[2,e.appendChild(r)]}}))}))},e.prototype.extendHtmlFileDetailsElements=function(e){var t=this;return function(){return Promise.all(a.selectAll(".file.Details").map((function(i){return n(t,void 0,void 0,(function(){var t,r,n,s;return o(this,(function(o){switch(o.label){case 0:if(!(t=a.selectOrThrow(".file-header",i)).dataset.path)return[2];if(r=e+"/"+t.dataset.path,!this.isSupportedFile(r))return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.addFrameToFileBody(a.selectOrThrow(".js-file-content",i),r,!0)];case 2:return(n=o.sent())?(this.addButtonsToFileHeaderActions(a.selectOrThrow(".file-actions>.flex-items-stretch",t),n),[3,4]):[2];case 3:return s=o.sent(),console.error(s),[3,4];case 4:return[2]}}))}))})))}},e.prototype.initDiff=function(e){e&&a.observeEl("#files",this.extendHtmlFileDetailsElements(e),{childList:!0,subtree:!0})},e.prototype.initCommit=function(){this.initDiff(l.getCommitSha())},e.prototype.initPRFiles=function(){var e;this.initDiff(null===(e=a.selectDOM(".js-reviews-container #head_sha"))||void 0===e?void 0:e.value)},e.prototype.initSingleFile=function(){return n(this,void 0,void 0,(function(){var e,t,i;return o(this,(function(r){switch(r.label){case 0:return e=a.selectOrThrow(".Box.mt-3>.Box-header.py-2"),t=l.getRepoPath().replace("blob/",""),this.isSupportedFile(t)?[4,this.addFrameToFileBody(a.selectOrThrow(".Box.mt-3>.Box-body.blob-wrapper"),t,!1)]:[2];case 1:return(i=r.sent())?(this.addButtonsToFileHeaderActions(a.selectOrThrow(".d-flex",e),i),[2]):[2]}}))}))},e.prototype.initFeature=function(){return Promise.all([l.isPRFiles()&&this.initPRFiles(),l.isSingleFile()&&this.initSingleFile(),l.isCommit()&&this.initCommit()]).then((function(e){return e.some(Boolean)}))},e}();t.ExtendFilePreview=h}}]);