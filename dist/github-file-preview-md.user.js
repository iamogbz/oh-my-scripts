// ==UserScript==
// @name        GitHub File Preview Markdown
// @version     1.1.3
// @author      iamogbz
// @description Render the raw markdown in thub
// @homepage    https://github.com/iamogbz/oh-my-scripts
// @supportURL  https://github.com/iamogbz/oh-my-scripts/issues
// @icon        https://github.com/iamogbz/oh-my-scripts/raw/master/assets/monkey_128.png
// @namespace   iamogbz/oh-my-scripts
// @grant       GM_xmlhttpRequest
// @include     *://github.com/*
// @downloadURL https://github.com/iamogbz/oh-my-scripts/raw/master/dist/github-file-preview-md.user.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/dom.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/github.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/paths.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/request.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/ns.js?v=0c9e265
// @require     https://github.com/iamogbz/oh-my-scripts/raw/master/dist/lib/github-file.js?v=0c9e265
// @updateURL   https://github.com/iamogbz/oh-my-scripts/raw/master/dist/github-file-preview-md.user.js?v=0c9e265
// ==/UserScript==

(()=>{"use strict";var t={839:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function l(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}u((r=r.apply(t,e||[])).next())}))},l=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(e,"__esModule",{value:!0});var u,c,s=n(1486),p=n(5008),f=n(1543),h=n(1603);(new(function(t){function e(){var e=t.call(this)||this;return e.id=f.filePreviewNS(u||(u=i(["extend-md"],["extend-md"]))),e.fileTypes=new Set(["md"]),e.featureClass=f.filePreviewNS(c||(c=i(["extend-md"],["extend-md"]))),e.frameTagName="div",e.frameStyle.height="auto",e.frameStyle.overflow="scroll hidden",e}return o(e,t),e.prototype.prepareHTML=function(t){return a(this,void 0,void 0,(function(){var e,n,r,o=this;return l(this,(function(i){return e="```",n="FENCED-CODE-TAG-PLACEHOLDER",r="```markdown\n"+t.replace(new RegExp(e,"g"),n)+e,[2,h.request("https://api.github.com/markdown",{method:"POST",data:JSON.stringify({text:r})}).then((function(t){var e;return null===(e=t.text)||void 0===e?void 0:e.call(t)})).then((function(t){return t?o.replaceText(t.replace(new RegExp(n,"g"),e),"<pre>","</pre>",(function(t){return null==t?void 0:t.split(/\r?\n/).map((function(t,e){return'<span class="blob-num bg-gray-light js-line-number" style="display: inline-block; margin-right: 10px">'+(e+1)+"</span>"+t})).join("\n")})):""}))]}))}))},e.prototype.replaceText=function(t,e,n,r){var o=t.indexOf(e),i=t.lastIndexOf(n);return t.substring(0,o)+e+r(t.substring(o+e.length,i))+n+t.substring(i+n.length)},e.prototype.frameElement=function(e){var n=t.prototype.frameElement.call(this,e);return n.removeAttribute("srcdoc"),n.innerHTML=e.srcDoc,n},e.prototype.getScrollHeight=function(t){return t.scrollHeight},e.prototype.showSource=function(e){return t.prototype.showRendered.call(this,e)},e.prototype.showRendered=function(e){return t.prototype.showSource.call(this,e)},e.prototype.addButtonsToFileHeaderActions=function(e,n){var r;t.prototype.addButtonsToFileHeaderActions.call(this,e,n),null===(r=s.selectDOM('.btn.BtnGroup-item[data-toggle-action="'+this.toggleActionRender+'"]'))||void 0===r||r.click()},e.prototype.setup=function(){var t=this;p.onAjaxedPagesRaw((function(){p.isSingleFile()&&t.initFeature()}))},e}(f.ExtendFilePreview))).setup()}},e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.m=t,n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={659:0},e=[[839,509,830,270,903,218,610]],r=()=>{};function o(){for(var r,o=0;o<e.length;o++){for(var i=e[o],a=!0,l=1;l<i.length;l++){var u=i[l];0!==t[u]&&(a=!1)}a&&(e.splice(o--,1),r=n(n.s=i[0]))}return 0===e.length&&(n.x(),n.x=()=>{}),r}n.x=()=>{n.x=()=>{},a=a.slice();for(var t=0;t<a.length;t++)i(a[t]);return(r=o)()};var i=o=>{for(var i,a,[u,c,s,p]=o,f=0,h=[];f<u.length;f++)a=u[f],n.o(t,a)&&t[a]&&h.push(t[a][0]),t[a]=0;for(i in c)n.o(c,i)&&(n.m[i]=c[i]);for(s&&s(n),l(o);h.length;)h.shift()();return p&&e.push.apply(e,p),r()},a=self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[],l=a.push.bind(a);a.push=i})(),n.x()})();