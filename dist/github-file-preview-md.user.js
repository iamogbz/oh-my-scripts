// ==UserScript==
// @name        GitHub File Preview Markdown
// @version     1.1.7
// @author      iamogbz
// @description Render the raw markdown in thub
// @homepage    https://github.com/iamogbz/oh-my-scripts
// @supportURL  https://github.com/iamogbz/oh-my-scripts/issues
// @icon        https://github.com/iamogbz/oh-my-scripts/raw/master/assets/monkey_128.png
// @namespace   iamogbz/oh-my-scripts
// @grant       GM_xmlhttpRequest
// @include     *://github.com/*
// @downloadURL https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/github-file-preview-md.user.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/dom.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/github.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/paths.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/request.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/ns.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/0b27891/dist/lib/github-file.js
// @updateURL   https://github.com/iamogbz/oh-my-scripts/raw/master/dist/github-file-preview-md.user.js
// ==/UserScript==

(()=>{"use strict";var e={839:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function l(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!((o=(o=l.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u,c,s=n(1486),p=n(5008),f=n(1543),h=n(1603);(new(function(e){function t(){var t=e.call(this)||this;return t.id=f.filePreviewNS(u||(u=i(["extend-md"],["extend-md"]))),t.fileTypes=new Set(["md"]),t.featureClass=f.filePreviewNS(c||(c=i(["extend-md"],["extend-md"]))),t.frameTagName="div",t.frameStyle.height="auto",t.frameStyle.overflow="hidden",t}return o(t,e),t.prototype.prepareHTML=function(e){return l(this,void 0,void 0,(function(){var t,n,r,o=this;return a(this,(function(i){return t="```",n="FENCED-CODE-TAG-PLACEHOLDER",r="```markdown\n"+e.replace(new RegExp(t,"g"),n)+t,[2,h.request("https://api.github.com/markdown",{method:"POST",data:JSON.stringify({text:r})}).then((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.call(e)})).then((function(e){if(!e)return"";var r=["<pre>",'<div style="display: flex">'],i=["</pre>","</div>"];return o.replaceText(e.replace(new RegExp(n,"g"),t).replace(r[0],r[1]).replace(i[0],i[1]),r[1],i[1],(function(e){var t=e.split(/\r?\n/);return'\n              <div style="display: flex; flex-direction: column">'+t.map((function(e,t){return'<span class="blob-num bg-gray-light js-line-number" style="margin-right: 10px; display: inline-block; height: 20px;">'+(t+1)+"</span>"})).join("")+'</div>\n              <div style="overflow: scroll hidden">'+t.map((function(e){return'<pre style="display: block; height: 20px;">'+e+"</pre>"})).join("\n")+"</div>\n            "}))}))]}))}))},t.prototype.replaceText=function(e,t,n,r){var o=e.indexOf(t),i=e.lastIndexOf(n);return e.substring(0,o)+t+r(e.substring(o+t.length,i))+n+e.substring(i+n.length)},t.prototype.frameElement=function(t){var n=e.prototype.frameElement.call(this,t);return n.removeAttribute("srcdoc"),n.innerHTML=t.srcDoc,n},t.prototype.getScrollHeight=function(e){return e.scrollHeight},t.prototype.showSource=function(t){var n=e.prototype.showRendered.call(this,t);return function(e){var r;return null===(r=t.parentElement)||void 0===r||r.classList.remove("p-5","p-xl-6"),n(e)}},t.prototype.showRendered=function(t){var n=e.prototype.showSource.call(this,t);return function(e){var r;return null===(r=t.parentElement)||void 0===r||r.classList.add("p-5","p-xl-6"),n(e)}},t.prototype.addButtonsToFileHeaderActions=function(t,n){var r;e.prototype.addButtonsToFileHeaderActions.call(this,t,n),null===(r=s.selectDOM('.btn.BtnGroup-item[data-toggle-action="'+this.toggleActionRender+'"]'))||void 0===r||r.click()},t.prototype.initCondition=function(){return p.isSingleFile()},t}(f.ExtendFilePreview))).setup()}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.x=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={659:0},t=[[839,509,830,270,903,218,610]],r=e=>{},o=(o,i)=>{for(var l,a,[u,c,s,p]=i,f=0,h=[];f<u.length;f++)a=u[f],n.o(e,a)&&e[a]&&h.push(e[a][0]),e[a]=0;for(l in c)n.o(c,l)&&(n.m[l]=c[l]);for(s&&s(n),o&&o(i);h.length;)h.shift()();return p&&t.push.apply(t,p),r()},i=self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[];function l(){for(var r,o=0;o<t.length;o++){for(var i=t[o],l=!0,a=1;a<i.length;a++){var u=i[a];0!==e[u]&&(l=!1)}l&&(t.splice(o--,1),r=n(n.s=i[0]))}return 0===t.length&&(n.x(),n.x=e=>{}),r}i.forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i));var a=n.x;n.x=()=>(n.x=a||(e=>{}),(r=l)())})(),n.x()})();