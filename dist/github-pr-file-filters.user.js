// ==UserScript==
// @name        GitHub PR File Filters
// @version     1.1.8
// @author      iamogbz
// @description Extend GitHub PR File Types Filter
// @homepage    https://github.com/iamogbz/oh-my-scripts
// @supportURL  https://github.com/iamogbz/oh-my-scripts/issues
// @icon        https://github.com/iamogbz/oh-my-scripts/raw/master/assets/monkey_128.png
// @namespace   iamogbz/oh-my-scripts
// @grant       GM_xmlhttpRequest
// @include     *://github.com/*
// @downloadURL https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/github-pr-file-filters.user.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/dom.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/github.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/paths.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/request.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/ns.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/219427c/dist/lib/debounce.js
// @updateURL   https://github.com/iamogbz/oh-my-scripts/raw/master/dist/github-pr-file-filters.user.js
// ==/UserScript==

(()=>{"use strict";var e,t={685:function(e,t,r){var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},l=this&&this.__assign||function(){return l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var l in t=arguments[r])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e},l.apply(this,arguments)},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var c=r(1486),i=r(5008),o=r(8008),s=r(8724),u={prFileTypes:{},prFiles:[],selectedFileTypes:new Set,shouldExtendFileType:!0};function d(e,t){var r=l(l({},u),e);JSON.stringify(u)!==JSON.stringify(r)?(Object.assign(u,r),t(!0)):t(!1)}function f(e,t){void 0===t&&(t=u.shouldExtendFileType);var r=(0,o.getFileType)(e,t?0:1);return r?".".concat(r):"No extension"}function p(e){var t,r,n={};try{for(var l=a(e),c=l.next();!c.done;c=l.next()){var i=c.value,o=i.fileName,s=i.isDeleted,u=f(o);u in n||(n[u]={count:0,deleted:0}),n[u].count+=1,s&&(n[u].deleted+=1)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return function(e){var t,r,n={};try{for(var l=a(Object.keys(e).sort((function(e,t){return e>t?1:0-Number(e<t)}))),c=l.next();!c.done;c=l.next()){var i=c.value;n[i]=e[i]}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return n}(n)}function y(e){return"iamogbz-pr-file-filters-".concat(e)}var h,v,m="js-file-filter-select-all-container",b=y(h||(h=n(["deselect-all-file-types"],["deselect-all-file-types"]))),g=y(v||(v=n(["extend-file-types-toggle"],["extend-file-types-toggle"])));function x(){return(0,c.selectOrThrow)(".js-file-filter")}function k(){return(0,c.selectOrThrow)(".select-menu-list .p-2",x())}function O(e){return(0,c.selectOrThrow)('.js-diff-file-type-option[value="'.concat(e,'"]'),k())}function T(e){var t=e.deletedCount,r=e.fileType,n=e.onChange,l=e.totalCount,a=l-t;function i(e){return"(".concat(e,")")}return(0,c.createElement)({attributes:{class:"d-flex"},children:[{attributes:{class:"pl-1 mb-1"},children:[{attributes:{checked:!0,class:"js-diff-file-type-option","data-deleted-files-count":t,"data-non-deleted-files-count":a,type:"checkbox",value:r},events:{change:n},tagName:"input"},r,{attributes:{class:"text-normal js-file-type-count","data-all-file-count-markup":i(l),"data-deleted-file-count-markup":i(t),"data-non-deleted-file-count-markup":i(a)},children:[i(l)],tagName:"span"}],tagName:"label"}],tagName:"div"})}function w(){var e,t=u.prFileTypes,r=Object.keys(t);u.selectedFileTypes=new Set(r.filter((function(e){return O(e).checked})));var n=(0,c.selectOrThrow)(".".concat(b),k()),l=u.selectedFileTypes.size>0;n.classList.remove("text-".concat(l?"gray":"blue")),n.classList.add("text-".concat(l?"blue":"gray"));var a=n.dataset,i=a.deselectAllMarkup,o=a.allDeselectedMarkup;n.innerText=null!==(e=l?i:o)&&void 0!==e?e:""}function j(){var e,t;if(u.selectedFileTypes.size>0)try{for(var r=a(u.selectedFileTypes),n=r.next();!n.done;n=r.next())O(n.value).click()}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else w()}function N(){d({prFileTypes:p(u.prFiles)},(function(e){e&&(function(){var e,t;try{for(var r=a((0,c.selectAll)(".file.Details")),n=r.next();!n.done;n=r.next()){var l=n.value,i=(0,c.selectOrThrow)(".file-header",l);if(!i.dataset.path)return;var o=f(i.dataset.path);i.dataset.fileType=o,l.dataset.fileType=o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}(),function(){var e,t,r=k();r.textContent="";var n=u.prFileTypes,l=Object.keys(n),i=(0,s.debounce)(w,50);try{for(var o=a(l),d=o.next();!d.done;d=o.next()){var f=d.value,p={deletedCount:n[f].deleted,fileType:f,onChange:i,totalCount:n[f].count};r.append(T(p))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r.append(function(e){var t=e.count,r=e.onClick,n=t>1?"types":"type",l="Select all ".concat(t," file ").concat(n),a="All ".concat(t," file ").concat(n," selected");return(0,c.createElement)({attributes:{class:"ml-1",style:(0,c.createElementStyle)({padding:"4px 0 0"})},children:[{attributes:{style:(0,c.createElementStyle)({cursor:"pointer"})},children:[{attributes:{class:"js-file-filter-select-all",hidden:!0,type:"checkbox"},tagName:"input"},{attributes:{class:"".concat(m," no-underline text-normal text-gray"),"data-all-selected-markup":a,"data-select-all-markup":l},events:{click:r},children:[a],tagName:"span"}],tagName:"label"}],tagName:"div"})}({count:l.length,onClick:i}));var y=(0,s.debounce)(j,50);r.append(function(e){var t=e.count,r=e.onClick,n=t>1?"types":"type",l="Deselect all ".concat(t," file ").concat(n),a="All ".concat(t," file ").concat(n," deselected");return(0,c.createElement)({attributes:{class:"ml-1",style:(0,c.createElementStyle)({padding:"6px 0 0"})},children:[{attributes:{style:(0,c.createElementStyle)({cursor:"pointer"})},children:[{attributes:{hidden:!0,type:"checkbox"},tagName:"input"},{attributes:{class:"".concat(b," no-underline text-normal text-blue"),"data-all-deselected-markup":a,"data-deselect-all-markup":l},events:{click:r},children:[l],tagName:"span"}],tagName:"label"}],tagName:"div"})}({count:l.length,onClick:y})),w()}())}))}function F(){var e=(0,c.selectOrThrow)("#".concat(g));d({shouldExtendFileType:!!e&&e.checked},(function(e){if(e){var t=k(),r=Object.keys(u.prFileTypes).length;u.selectedFileTypes.size!==r&&(0,c.selectOrThrow)(".".concat(m),t).click(),N()}}))}function E(e){u.prFiles=e;var t,r=(0,c.selectOrThrow)(".select-menu-header",x());(0,c.selectExists)("#".concat(g),r)||(r.append((t=F,(0,c.createElement)({children:[{children:["Use full extension "],tagName:"span"},{attributes:{checked:u.shouldExtendFileType,id:g,type:"checkbox"},events:{change:t},tagName:"input"}],tagName:"label"}))),N())}(0,i.onAjaxedPagesRaw)((function(){var e,t;if((0,i.isPRFiles)())return(e=(0,i.getCleanPathname)().replace("/pull/","/pulls/"),t="repos/".concat(e,"?per_page=1000"),i.githubApi.v3(t).then((function(e){return e?e.map((function(e){var t=e.status;return{fileName:e.filename,isDeleted:"removed"===t}})):[]}))).then(E)}))}},r={};function n(e){var l=r[e];if(void 0!==l)return l.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,r,l,a)=>{if(!r){var c=1/0;for(u=0;u<e.length;u++){for(var[r,l,a]=e[u],i=!0,o=0;o<r.length;o++)(!1&a||c>=a)&&Object.keys(n.O).every((e=>n.O[e](r[o])))?r.splice(o--,1):(i=!1,a<c&&(c=a));if(i){e.splice(u--,1);var s=l();void 0!==s&&(t=s)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,l,a]},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={647:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var l,a,[c,i,o]=r,s=0;if(c.some((t=>0!==e[t]))){for(l in i)n.o(i,l)&&(n.m[l]=i[l]);if(o)var u=o(n)}for(t&&t(r);s<c.length;s++)a=c[s],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},r=self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var l=n.O(void 0,[509,830,270,903,218,358],(()=>n(685)));l=n.O(l)})();