// ==UserScript==
// @name        GitHub PR File Filters
// @version     1.1.9
// @author      iamogbz
// @description Extend GitHub PR File Types Filter
// @homepage    https://github.com/iamogbz/oh-my-scripts
// @supportURL  https://github.com/iamogbz/oh-my-scripts/issues
// @icon        https://github.com/iamogbz/oh-my-scripts/raw/master/assets/monkey_128.png
// @namespace   iamogbz/oh-my-scripts
// @grant       GM_xmlhttpRequest
// @include     *://github.com/*
// @downloadURL https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/github-pr-file-filters.user.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/dom.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/github.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/paths.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/request.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/ns.js
// @require     https://github.com/iamogbz/oh-my-scripts/raw/cdcc0b8/dist/lib/debounce.js
// @updateURL   https://github.com/iamogbz/oh-my-scripts/raw/master/dist/github-pr-file-filters.user.js
// ==/UserScript==

(()=>{"use strict";var e,t={685:function(e,t,n){var r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},l=this&&this.__assign||function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var l in t=arguments[n])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e},l.apply(this,arguments)},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var c=n(1486),i=n(5008),o=n(8008),s=n(8724),u={prFileTypes:{},prFiles:[],selectedFileTypes:new Set,shouldExtendFileType:!0};function d(e,t){var n=l(l({},u),e);JSON.stringify(u)!==JSON.stringify(n)?(Object.assign(u,n),t(!0)):t(!1)}function f(e,t){void 0===t&&(t=u.shouldExtendFileType);var n=(0,o.getFileType)(e,t?0:1);return n?".".concat(n):"No extension"}function p(e){var t,n,r={};try{for(var l=a(e),c=l.next();!c.done;c=l.next()){var i=c.value,o=i.fileName,s=i.isDeleted,u=f(o);u in r||(r[u]={count:0,deleted:0}),r[u].count+=1,s&&(r[u].deleted+=1)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return function(e){var t,n,r={};try{for(var l=a(Object.keys(e).sort((function(e,t){return e>t?1:0-Number(e<t)}))),c=l.next();!c.done;c=l.next()){var i=c.value;r[i]=e[i]}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return r}(r)}function y(e){return"iamogbz-pr-file-filters-".concat(e)}var h,v,m="js-file-filter-select-all-container",b=y(h||(h=r(["deselect-all-file-types"],["deselect-all-file-types"]))),g=y(v||(v=r(["extend-file-types-toggle"],["extend-file-types-toggle"])));function k(){return(0,c.selectOrThrow)(".js-file-filter")}function x(){return(0,c.selectOrThrow)(".select-menu-list .pt-2",k())}function O(e){return(0,c.selectOrThrow)('.js-diff-file-type-option[value="'.concat(e,'"]'),x())}function T(e){return"color-fg-".concat(e?"accent":"muted")}function w(e){var t=e.deletedCount,n=e.fileType,r=e.onChange,l=e.totalCount,a=l-t;function i(e){return"(".concat(e,")")}return(0,c.createElement)({attributes:{class:"d-flex"},children:[{attributes:{class:"pl-1 mb-1"},children:[{attributes:{checked:!0,class:"js-diff-file-type-option","data-deleted-files-count":t,"data-non-deleted-files-count":a,type:"checkbox",value:n},events:{change:r},tagName:"input"},n,{attributes:{class:"text-normal js-file-type-count","data-all-file-count-markup":i(l),"data-deleted-file-count-markup":i(t),"data-non-deleted-file-count-markup":i(a)},children:[i(l)],tagName:"span"}],tagName:"label"}],tagName:"div"})}function j(){var e,t,n=u.prFileTypes,r=Object.keys(n);u.selectedFileTypes=new Set(r.filter((function(e){return O(e).checked})));var l=(0,c.selectOrThrow)(".".concat(m),x()),a=u.selectedFileTypes.size===new Set(r).size;l.classList.remove(T(a)),l.classList.add(T(!a));var i=l.dataset,o=i.selectAllMarkup,s=i.allSelectedMarkup;l.innerText=null!==(e=a?s:o)&&void 0!==e?e:"";var d=(0,c.selectOrThrow)(".".concat(b),x()),f=u.selectedFileTypes.size>0;d.classList.remove(T(!f)),d.classList.add(T(f));var p=d.dataset,y=p.deselectAllMarkup,h=p.allDeselectedMarkup;d.innerText=null!==(t=f?y:h)&&void 0!==t?t:""}function F(e){var t,n;if(e.size>0)try{for(var r=a(e),l=r.next();!l.done;l=r.next())O(l.value).click()}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}else j()}function N(){F(u.selectedFileTypes)}function C(){F(new Set(Object.keys(u.prFileTypes).filter((function(e){return!u.selectedFileTypes.has(e)}))))}function E(){d({prFileTypes:p(u.prFiles)},(function(e){e&&(function(){var e,t;try{for(var n=a((0,c.selectAll)(".file.Details")),r=n.next();!r.done;r=n.next()){var l=r.value,i=(0,c.selectOrThrow)(".file-header",l);if(!i.dataset.path)return;var o=f(i.dataset.path);i.dataset.fileType=o,l.dataset.fileType=o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}(),function(){var e,t,n=x();n.textContent="";var r=u.prFileTypes,l=Object.keys(r),i=(0,s.debounce)(j,50);try{for(var o=a(l),d=o.next();!d.done;d=o.next()){var f=d.value,p={deletedCount:r[f].deleted,fileType:f,onChange:i,totalCount:r[f].count};n.append(w(p))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}var y=(0,s.debounce)(C,50);n.append(function(e){var t=e.count,n=e.onClick,r=t>1?"types":"type",l="Select all ".concat(t," file ").concat(r),a="All ".concat(t," file ").concat(r," selected");return(0,c.createElement)({attributes:{class:"ml-1 mt-1"},children:[{attributes:{style:(0,c.createElementStyle)({cursor:"pointer"})},children:[{attributes:{class:"js-file-filter-select-all",hidden:!0,type:"checkbox","data-action":"change:file-filter#enableAllFileInputs","data-target":"file-filter.selectAllInput"},tagName:"input"},{attributes:{class:"".concat(m," no-underline text-normal ").concat(T(!1)),"data-all-selected-markup":a,"data-select-all-markup":l,"data-target":"file-filter.selectAllContainer"},events:{click:n},children:[a],tagName:"span"}],tagName:"label"}],tagName:"div"})}({count:l.length,onClick:y}));var h=(0,s.debounce)(N,50);n.append(function(e){var t=e.count,n=e.onClick,r=t>1?"types":"type",l="Deselect all ".concat(t," file ").concat(r),a="All ".concat(t," file ").concat(r," deselected");return(0,c.createElement)({attributes:{class:"ml-1 mt-1",style:(0,c.createElementStyle)({padding:"2px 0 0"})},children:[{attributes:{style:(0,c.createElementStyle)({cursor:"pointer"})},children:[{attributes:{hidden:!0,type:"checkbox"},tagName:"input"},{attributes:{class:"".concat(b," no-underline text-normal ").concat(T(!0)),"data-all-deselected-markup":a,"data-deselect-all-markup":l},events:{click:n},children:[l],tagName:"span"}],tagName:"label"}],tagName:"div"})}({count:l.length,onClick:h})),j()}())}))}function S(){var e=(0,c.selectOrThrow)("#".concat(g));d({shouldExtendFileType:!!e&&e.checked},(function(e){if(e){var t=x(),n=Object.keys(u.prFileTypes).length;u.selectedFileTypes.size!==n&&(0,c.selectOrThrow)(".".concat(m),t).click(),E()}}))}function _(e){u.prFiles=e;var t,n=(0,c.selectOrThrow)(".select-menu-header",k());(0,c.selectExists)("#".concat(g),n)||(n.append((t=S,(0,c.createElement)({children:[{children:["Use full extension "],tagName:"span"},{attributes:{checked:u.shouldExtendFileType,id:g,type:"checkbox"},events:{change:t},tagName:"input"}],tagName:"label"}))),E())}(0,i.onAjaxedPagesRaw)((function(){var e,t;if((0,i.isPRFiles)())return(e=(0,i.getCleanPathname)().replace("/pull/","/pulls/"),t="repos/".concat(e,"?per_page=1000"),i.githubApi.v3(t).then((function(e){return e?e.map((function(e){var t=e.status;return{fileName:e.filename,isDeleted:"removed"===t}})):[]}))).then(_)}))}},n={};function r(e){var l=n[e];if(void 0!==l)return l.exports;var a=n[e]={exports:{}};return t[e].call(a.exports,a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,l,a)=>{if(!n){var c=1/0;for(u=0;u<e.length;u++){for(var[n,l,a]=e[u],i=!0,o=0;o<n.length;o++)(!1&a||c>=a)&&Object.keys(r.O).every((e=>r.O[e](n[o])))?n.splice(o--,1):(i=!1,a<c&&(c=a));if(i){e.splice(u--,1);var s=l();void 0!==s&&(t=s)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,l,a]},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={647:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var l,a,[c,i,o]=n,s=0;if(c.some((t=>0!==e[t]))){for(l in i)r.o(i,l)&&(r.m[l]=i[l]);if(o)var u=o(r)}for(t&&t(n);s<c.length;s++)a=c[s],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(u)},n=self.webpackChunkoh_my_scripts=self.webpackChunkoh_my_scripts||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var l=r.O(void 0,[509,830,270,903,218,358],(()=>r(685)));l=r.O(l)})();